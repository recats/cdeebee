!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("ramda"),require("lodash"),require("axios"),require("crypto")):"function"==typeof define&&define.amd?define(["exports","ramda","lodash","axios","crypto"],t):t((e=e||self).cdeebee={},e.ramda,e.lodash,e.axios,e.crypto)}(this,function(e,t,r,n,a){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n,a=a&&a.hasOwnProperty("default")?a.default:a;var i=function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function s(e,t){var r,n,a,i,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function o(i){return function(o){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(a=(a=s.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){s.label=i[1];break}if(6===i[0]&&s.label<a[1]){s.label=a[1],a=i;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(i);break}a[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,o])}}}var o,E,c,u="0123456789abcdefghijklmnopqrstuvwxyz";(o=e.cdeebeeTypes||(e.cdeebeeTypes={})).CDEEBEE_REQUESTMANAGER_SHIFT="@@cdeebee/REQUESTMANAGER_SHIFT",o.CDEEBEE_REQUESTMANAGER_SET="@@cdeebee/REQUESTMANAGER_SET",o.CDEEBEE_ERRORHANDLER_SET="@@cdeebee/ERRORHANDLER_SET",o.CDEEBEE_ENTITY_CHANGE_FIELD="@@cdeebee/ENTITY_CHANGE_FIELD",o.CDEEBEE_RESET_ENTITY="@@cdeebee/RESET_ENTITY",o.CDEEBEE_SET_ENTITY="@@cdeebee/SET_ENTITY",o.CDEEBEEE_UPDATE="@@cdeebee/UPDATE",o.CDEEBEEE_DROP="@@cdeebee/DROP",o.CDEEBEEE_DROP_ELEMENT="@@cdeebee/DROP_ELEMENT",o.CDEEBEE_INTERNAL_ERROR="@@cdeebee/INTERNAL_ERROR",o.CDEEBEEE_DROP_REQUEST_BY_API_URL="@@cdeebee/DROP_REQUEST_BY_API_URL",o.CHANGE_ROUTE="@@router/LOCATION_CHANGE",(E=e.cdeebeeEntityState||(e.cdeebeeEntityState={})).NEW="NEW",E.EDITING="EDITING",E.NORMAL="NORMAL",(c=e.cdeebeeMergeStrategy||(e.cdeebeeMergeStrategy={})).merge="merge",c.replace="replace",(e.cdeebeeRequestStrategy||(e.cdeebeeRequestStrategy={})).skipCdeeBeeUpdate="skipCdeeBeeUpdate";var y=function(e){return t.omit(["__entity","__state"],e)},p=function(e){return e.filter(function(e){return!e.requestCancel&&e.source&&e.source.cancel instanceof Function})};var d=function(t){var n=r.get(t,"__entity.__state")||r.get(t,"__state");return n||e.cdeebeeEntityState.NORMAL},l=function(t){return d(t)===e.cdeebeeEntityState.NORMAL?(console.warn("reset works only in editing and new states"),t):y(t)},f=function(n,a,i){var s=r.get(n,a);if(d(s[i])===e.cdeebeeEntityState.EDITING)return console.log("editing"),n;console.log("createNew");var o=t.assocPath([a,i,"__entity"],s[i],n);return t.assocPath([a,i,"__entity","__state"],e.cdeebeeEntityState.EDITING,o)},_=function(e,r,n){for(var a=n||[],i=e,s=0;s<r.length;s++){var o=r[s];i=t.assocPath(a.concat(o.key),o.value,i)}return i},b=function(r){for(var n=r.response,a=(n.responseStatus,function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r}(n,["responseStatus"])),i=r.cdeebee,s=r.mergeStrategy,o=r.primaryKey,E=0,c=Object.keys(a);E<c.length;E++){var u=c[E],y={};if(a[u]instanceof Object&&a[u].hasOwnProperty(o)){for(var p=0,d=a[u].data;p<d.length;p++){var l=d[p];y[l[a[u][o]]]=l}s===e.cdeebeeMergeStrategy.merge?a[u]=t.mergeDeepRight(i[u],y):s===e.cdeebeeMergeStrategy.replace&&(a[u]=y)}else null!==a[u]&&void 0!==a[u]&&"string"!=typeof a[u]||(a=t.omit([u],a))}return a},R=Object.freeze({cancelationRequest:p,checkNetworkActivity:function(e,t){if(!t||0===e.length)return!1;for(var r=t instanceof Array?t:[t],n=e.map(function(e){return e.api}),a=0;a<r.length;a+=1)if(n.includes(r[a]))return!0;return!1},getSubEntity:function(e){return e.__entity||e},getEntityState:d,insertEntity:function(t){return t.__state=e.cdeebeeEntityState.NEW,t},commitEntity:function(t){return d(t)===e.cdeebeeEntityState.NORMAL?(console.warn("commit works only in editing and new states"),t):y(t)},resetEntity:l,editEntity:f,batchingUpdate:_,defaultNormalize:b}),T={},h={activeRequest:[],requestByApiUrl:{},errorHandler:{}};var g=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e){if(a.randomFillSync){var t={};e.exports=function(e){var r=t[e];return r||(r=Buffer.allocUnsafe(e),e<=255&&(t[e]=r)),a.randomFillSync(r)}}else e.exports=a.randomBytes}),D=function(e,t){return function(e,t,r){var n=(2<<Math.log(t.length-1)/Math.LN2)-1,a=Math.ceil(1.6*n*r/t.length);r=+r;for(var i="";;)for(var s=e(a),o=0;o<a;o++){var E=s[o]&n;if(t[E]&&(i+=t[E]).length===r)return i}}(g,e,t)},v={},S=function(a,o){var E=this;this.send=function(a){return function(o,c){return y=E,p=void 0,l=function(){var E,y,p,d,l,f,_,b,R,T,h,g,S,m,C,N,A,I,O,B,L,q,U,P,w,M,G,j,x,H,k,K,Y,F,Q,z,W,J,V;return s(this,function(s){switch(s.label){case 0:E=t.mergeDeepRight(this.requestObject,a),y=E.api,p=E.preUpdate,d=E.postUpdate,l=E.preError,f=E.postError,_=E.data,b=E.files,R=E.requestCancel,T=void 0===R||R,h=E.requestStrategy,g=E.fileKey,S=void 0===g?this.options.fileKey:g,m=E.primaryKey,C=void 0===m?this.options.primaryKey:m,N=E.bodyKey,A=void 0===N?this.options.bodyKey:N,I=E.method,O=void 0===I?this.options.method:I,B=E.normalize,L=void 0===B?this.options.normalize:B,q=E.mergeStrategy,U=void 0===q?this.options.mergeStrategy:q,P=E.headers,w=void 0===P?this.options.headers:P,M=E.responseKeyCode,G=void 0===M?this.options.responseKeyCode:M,s.label=1;case 1:if(s.trys.push([1,3,,4]),j=D(u,15),x=JSON.stringify(i({},_,{requestID:j})),H=n.CancelToken.source(),o({type:e.cdeebeeTypes.CDEEBEE_REQUESTMANAGER_SET,payload:{nanoID:j,api:y,source:H,data:_,requestCancel:T}}),b){for(k=new FormData,K=0;K<b.length;K+=1)S&&k.append(S,b[K]);A&&k.append(A,x),x=k}return[4,n({url:y,method:O,headers:w,data:x})];case 2:if(Y=s.sent())for(v=Object.assign(((V={})[j]={response:Y.data,requestApi:y},V),v);v[r.get(c().requestManager.activeRequest,"[0].nanoID")];)if(F=c().requestManager.activeRequest[0].nanoID,Q=v[F],z=Q.response,W=Q.requestApi,delete v[F],o({type:e.cdeebeeTypes.CDEEBEE_REQUESTMANAGER_SHIFT}),G&&0===z[G]){switch(p&&p(Y.data),h){case e.cdeebeeRequestStrategy.skipCdeeBeeUpdate:break;default:o({type:e.cdeebeeTypes.CDEEBEEE_UPDATE,payload:{response:L instanceof Function&&L({response:z,cdeebee:c().cdeebee,mergeStrategy:U,primaryKey:C}),cleanResponse:z,api:W,mergeStrategy:U}})}d&&d(Y.data)}else l&&l(Y.data),o({type:e.cdeebeeTypes.CDEEBEE_ERRORHANDLER_SET,payload:{api:W,cleanResponse:z}}),f&&f(Y.data);return[3,4];case 3:return J=s.sent(),o({type:e.cdeebeeTypes.CDEEBEE_INTERNAL_ERROR}),console.warn("@@makeRequest-error",J),console.warn("@@makeRequest-object",t.mergeDeepRight(this.requestObject,a)),[3,4];case 4:return[2]}})},new((d=void 0)||(d=Promise))(function(e,t){function r(e){try{a(l.next(e))}catch(e){t(e)}}function n(e){try{a(l.throw(e))}catch(e){t(e)}}function a(t){t.done?e(t.value):new d(function(e){e(t.value)}).then(r,n)}a((l=l.apply(y,p||[])).next())});var y,p,d,l}},this.requestObject=a,this.options=i({fileKey:"files",bodyKey:"body",method:"POST",primaryKey:"primaryKey",normalize:b,mergeStrategy:e.cdeebeeMergeStrategy.merge,responseKeyCode:"responseStatus",headers:{"content-type":"application/json"}},o)};var m=Object.freeze({setKeyValue:function(t,r,n,a){return function(i,s){a&&a.preChange&&a.preChange({entityList:t,entityID:r,valueList:n,dispatch:i,getState:s}),i({type:e.cdeebeeTypes.CDEEBEE_ENTITY_CHANGE_FIELD,payload:{entityList:t,entityID:r,valueList:n}}),a&&a.postChange&&a.postChange({entityList:t,entityID:r,valueList:n,dispatch:i,getState:s})}},commitEntity:function(t,r,n,a){return function(i,s){a&&a.preCommit&&a.preCommit({entityList:t,entityID:r,entity:n,dispatch:i,getState:s}),i({type:e.cdeebeeTypes.CDEEBEE_SET_ENTITY,payload:{entityList:t,entityID:r,entity:n}}),a&&a.postCommit&&a.postCommit({entityList:t,entityID:r,entity:n,dispatch:i,getState:s})}},resetEntity:function(t,r,n){return function(a,i){n&&n.preCommit&&n.preCommit({entityList:t,entityID:r,dispatch:a,getState:i}),a({type:e.cdeebeeTypes.CDEEBEE_RESET_ENTITY,payload:{entityList:t,entityID:r}}),n&&n.postCommit&&n.postCommit({entityList:t,entityID:r,dispatch:a,getState:i})}},dropRequestByApiUrl:function(t){return function(r){return r({type:e.cdeebeeTypes.CDEEBEEE_DROP_REQUEST_BY_API_URL,payload:{api:t}})}}});e.CdeebeeRequest=S,e.cdeebee=function(r,n){void 0===r&&(r=T);var a=n.type,s=n.payload;switch(a){case e.cdeebeeTypes.CDEEBEEE_UPDATE:return i({},r,s.response);case e.cdeebeeTypes.CDEEBEE_ENTITY_CHANGE_FIELD:var o=f(r,s.entityList,s.entityID);return _(o,s.valueList,[s.entityList,s.entityID,"__entity"]);case e.cdeebeeTypes.CDEEBEE_SET_ENTITY:return t.assocPath([s.entityList,s.entityID],s.entity,r);case e.cdeebeeTypes.CDEEBEE_RESET_ENTITY:var E=r[s.entityList];return t.assocPath([s.entityList,s.entityID],l(E[s.entityID]),r);case e.cdeebeeTypes.CDEEBEEE_DROP:return T;case e.cdeebeeTypes.CDEEBEEE_DROP_ELEMENT:return t.omit([s.entityList,s.entityID],r);default:return r}},e.cdeebeeActions=m,e.cdeebeeHelpers=R,e.requestManager=function(r,n){var a,s;void 0===r&&(r=h);var o=n.type,E=n.payload;switch(o){case e.cdeebeeTypes.CDEEBEE_REQUESTMANAGER_SET:return i({},r,{activeRequest:r.activeRequest.concat([E])});case e.cdeebeeTypes.CDEEBEE_REQUESTMANAGER_SHIFT:return i({},r,{activeRequest:t.slice(1,1/0,r.activeRequest)});case e.cdeebeeTypes.CDEEBEEE_UPDATE:return i({},r,{requestByApiUrl:i({},r.requestByApiUrl,(a={},a[E.api]=E.cleanResponse,a))});case e.cdeebeeTypes.CDEEBEEE_DROP_REQUEST_BY_API_URL:return i({},r,{requestByApiUrl:t.dissoc(E.api,r.requestByApiUrl)});case e.cdeebeeTypes.CDEEBEE_ERRORHANDLER_SET:return i({},r,{errorHandler:i({},r.errorHandler,(s={},s[E.api]=E.cleanResponse,s))});case e.cdeebeeTypes.CDEEBEE_INTERNAL_ERROR:return i({},r,{activeRequest:[],requestByApiUrl:{}});case e.cdeebeeTypes.CHANGE_ROUTE:return i({},h,{activeRequest:p(r.activeRequest)});default:return r}},Object.defineProperty(e,"__esModule",{value:!0})});
